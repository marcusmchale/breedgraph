"""
Ontology entries with a given label should form directed acyclic graphs with source and sink
relationships described for each label type as parents and children.
Relationships across labels may be formed through the term type,
or through type specific links for other types,
such as the subject type which is associated with traits and conditions.
"""
type Version {
    id: Int!
    major: Int!
    minor: Int!
    patch: Int!
    comment: String!
}

type OntologyCommit {
    version: Version
    comment: String
    # Set by the server
    time: DateTime
    user: User
    # References not handled
    licence: Int
    copyright: Int
}
"""
Ontology entries are created in draft phase.
When a commit is submitted, drafts become active,
and deprecated become removed.
"""
enum LifecyclePhase {
    DRAFT
    ACTIVE
    DEPRECATED
    REMOVED
}

"""
Ontology entries form a graph
Each label is represented by directed acyclic graphs with source and sink
relationships described for each node as parents and children.
Each entry has an OntologyEntryLabel to distinguish various classes of entry.
"""
enum OntologyEntryLabel {
    """
    Term entries may be used to relate other key terms in the ontology.
    Example: "Metabolism" may be a term.
    """
    TERM
    """
    Subject entries describe Units (see Blocks) being observed in a study.
    These are linked to Unit and Trait.
    Examples: "Leaf", "Tree", "Field", "Rhizosphere"
    """
    SUBJECT
    """
    Scale entries describe units or classes used for values in a Dataset.
    These are linked to Variable or Factor .
    Scale entries require a ScaleType.
    For Nominal and Ordinal types, additional Category references may be provided.
    Examples:
    "Centimeters", "Counts per million", "Micro-Einsteins" are all ScaleType numerical.
    "Plant Genetic Material" is ScaleType nominal, and categories should include references to GermplasmEntries.
    """
    SCALE
    """
    Category entries describe classes for Scale entries with type Nominal or Ordinal.
    These are linked to Scale entries.
    Ordinal scales require a "rank" parameter for each category.
    Examples: "High", "Medium", "Low" with ranks 2, 1 and 0, respectively.
    """
    CATEGORY
    """
    Observation method entries describe the way a value is determined.
    These are linked to Variable.
    Observation method entries require an ObservationMethodType.
    Examples: "Distance measurement with calibrated reference", "Short-read sequencing", "Rain Gauge".
    """
    OBSERVATION_METHOD
    """
    Trait entries describe observed properties of a subject (phenotype for a plant subject)
    These are linked to Variable and Subject.
    Examples:
    "Height", "Gene expression" linked to a tree subject.
    """
    TRAIT
    """
    Variable entries link a Trait, ObservationMethod and Scale
    to form a single reference term for a Dataset (see Datasets).
    Examples:
    "Tree height" where:
        Trait = "Height",
        Method = "Distance measurement with calibrated reference",
        Scale = "Centimeters".
    "Normalised Expression" where:
        Trait = "Gene expression",
        Method = "Short read sequencing",
        Scale = "Counts per million"
    """
    VARIABLE
    """
    Control method entries describe the way a value is maintained for an experiment.
    These are linked to Factor.
    Examples: "Fluorescent Lighting", "Fertilizer application", "Germplasm selection"
    """
    CONTROL_METHOD
    """
    Condition entries describe the quantities/qualities that are fixed/controlled throughout an experiment.
    These are linked to Factor entries.
    Examples: "Light level", "Controlled Grafting", "Water availability"
    """
    CONDITION
    """
    Factor entries link a Condition, ControlMethod and Scale
    to form a single entry for a Dataset (see Datasets).
    Examples:
    "Controlled lighting" where:
        Condition = "Light level", ControlMethod = "Fluorescent lighting", Scale = "Micro Einsteins"
    OR
    "Controlled water availability" where:
        Condition = "Water availability", ControlMethod = "Controlled water application", Scale = "L/m2/day"
    OR
    "Grafted Material" where:
        Condition = "Genetic material", ControlMethod = "Controlled Grafting", Scale = "Plant Genetic Material"
    """
    FACTOR
    """
    Event entries link multiple Variables and Factors
    Examples:
    "Harvest" event with "Harvest method" factor, and "Yield" variable.
    """
    EVENT
    """
    LocationType entries describe types of locations.
    These are linked to Location (see Regions).
    Examples: "Country", "State", "Field"
    """
    LOCATION_TYPE
    """
    LayoutType entries describe types of arrangements.
    These are linked to Layout (see Arrangements).
    Examples: "Grid", "Rows"
    """
    LAYOUT_TYPE
    """
    Design entries describe statistical designs for a study.
    These are linked to Study (see Programs).
    Examples: "Split-plot", "Randomized block"
    """
    DESIGN
    """
    Role entries describe roles for people.
    These are linked to Person (see People).
    Examples: "Post-doctoral researcher", "Principal Investigator"
    """
    ROLE
    """
    Title entries describe titles for people.
    These are linked to Person (see People).
    Examples: "Professor", "Doctor"
    """
    TITLE
}

enum OntologyRelationshipLabel{
    """Any => SAME_TYPE"""
    PARENT_OF
    """Any => Term"""
    HAS_TERM
    """Scale -> Category"""
    HAS_CATEGORY
    """Trait/Condition -> Subject"""
    DESCRIBES_SUBJECT
    """Variable -> Trait"""
    DESCRIBES_TRAIT
    """Factor -> Condition"""
    DESCRIBES_CONDITION
    """Variable -> ObservationMethod"""
    USES_OBSERVATION_METHOD
    """Factor -> ControlMethod"""
    USES_CONTROL_METHOD
    """Variable/Factor -> Scale"""
    USES_SCALE
    """Event -> Factor"""
    DESCRIBES_FACTOR
    """EventType -> Variable"""
    DESCRIBES_VARIABLE
}

enum AxisType {
    """
    String values with no implied directional relationship
    e.g. Growth Facility
    """
    NOMINAL
    """
    String values values that convey a sequence.
    e.g. Row number
    """
    ORDINAL
    """
    Numeric values that convey position within Euclidean space.
    This may be a curvilinear/affine space with unknown transformations.
    e.g. Distance from start of row when rows follow the surface topology.
    """
    COORDINATE
    """
    Cartesian coordinates are a subset of the AxisType.COORDINATE that additionally allow distance calculations.
    AxisType.CARTESIAN should be preferred when the coordinate space is approximately Cartesian,
    i.e. all axes noted as AxisType.CARTESIAN for a given layout must:
     - be pair-wise perpendicular,
     - have a common origin,
     - and common unit of length.
    e.g. Distance from start of row when rows lines are straight and perpendicular to the row axis.
    """
    CARTESIAN
}

enum ObservationMethodType{
    MEASUREMENT
    COUNTING
    ESTIMATION
    COMPUTATION
    PREDICTION
    DESCRIPTION
    CLASSIFICATION
}

enum ControlMethodType{
    """ Environmental controls, e.g. light, temperature, humidity. """
    ENVIRONMENTAL
    """ Nutritional controls, e.g. fertilizer application. """
    NUTRITIONAL
    """ Chemical controls (non-nutritive) .e.g. herbicides, hormones etc. """
    CHEMICAL
    """ Biological controls, e.g. microbial treatment, fungal inoculation, insect colonization"""
    BIOLOGICAL
    """ Genetic controls, e.g. germplasm selection """
    GENETIC
    """ Management controls, e.g. cropping density, pruning """
    MANAGEMENT
}

enum ScaleType {
    DATE,
    DURATION,
    NUMERICAL,
    NOMINAL,
    ORDINAL,
    TEXT,
    GERMPLASM,
    COMPLEX
}

interface OntologyEntryInterface {
    id: Int!
    name: String!

    description: String
    abbreviation: String
    synonyms: [String]
    authors: [Int]
    references: [Int]

    parents: [OntologyEntryInterface]
    children: [OntologyEntryInterface]
}


interface RelatedToTerms {
    terms: [Term]
}


"""
Term entries may be used to relate other key terms in the ontology.
Example: "Metabolism" may be a term.
"""
type Term implements OntologyEntryInterface {
    id: Int!
    name: String!

    description: String
    abbreviation: String
    synonyms: [String]
    authors: [Int]
    references: [Int]

    parents: [Term]
    children: [Term]

    subjects: [Subject]
    scales: [Scale]
    categories: [Category]
    observationMethods: [ObservationMethod]
    traits: [Trait]
    variables: [Variable]
    controlMethods: [ControlMethod]
    conditions: [Condition]
    factors: [Factor]
    events: [Event]
    locationTypes: [LocationType]
    layoutTypes: [LayoutType]
    designs: [Design]
    roles: [Role]
    titles: [Title]
}

"""
Subject entries describe Units (see Blocks) being observed in a study.
These are linked to Unit and Trait.
Examples: "Leaf", "Tree", "Field", "Rhizosphere"
"""
type Subject implements OntologyEntryInterface & RelatedToTerms {
    id: Int!
    name: String!

    description: String
    abbreviation: String
    synonyms: [String]
    authors: [Int]
    references: [Int]

    parents: [Subject]
    children: [Subject]

    terms: [Term]

    traits: [Trait]
    conditions: [Condition]
}

"""
Trait entries describe observed properties of a subject (phenotype for a plant subject)
These are linked to Variable and Subject.
Examples:
"Height", "Gene expression" linked to a tree subject.
"""
type Trait implements OntologyEntryInterface & RelatedToTerms {
    id: Int!
    name: String!

    description: String
    abbreviation: String
    synonyms: [String]
    authors: [Int]
    references: [Int]

    parents: [Trait]
    children: [Trait]

    terms: [Term]

    subjects: [Subject]
    variables: [Variable]
}

"""
Condition entries describe the quantities/qualities that are fixed/controlled throughout an experiment.
These are linked to Factor entries.
Examples: "Light level", "Controlled Grafting", "Water availability"
"""
type Condition implements OntologyEntryInterface & RelatedToTerms {
    id: Int!
    name: String!

    description: String
    abbreviation: String
    synonyms: [String]
    authors: [Int]
    references: [Int]

    parents: [Condition]
    children: [Condition]

    terms: [Term]

    subjects: [Subject]
    factors: [Factor]
}

"""
Scale entries describe the units, classes or dimensions for values associated with a Variable or Factor.
Scale entries require a ScaleType.
For Nominal and Ordinal types, additional Category references may be provided.
Ordinal scales represent the rank of categories by their presentation order.
Germplasm scales reference GermplasmEntries
Complex scales allow for the description of data that cannot be represented by simple values (integer, float, string), nor by
internal references like Germplasm or Categorical (nominal or ordinal) scales.
Examples:
"Centimeters", "Counts per million", "Micro-Einsteins" are all ScaleType numerical.
"Plant Genetic Material" would be ScaleType Germplasm
"MAG abundance" would be ScaleType complex, with associated datasets providing references to stored files, e.g. in HDF5 format.

"""
type Scale implements OntologyEntryInterface & RelatedToTerms {
    id: Int!
    name: String!

    description: String
    abbreviation: String
    synonyms: [String]
    authors: [Int]
    references: [Int]

    parents: [Scale]
    children: [Scale]

    terms: [Term]

    scaleType: ScaleType!
    categories: [Category]

    variables: [Variable]
    factors: [Factor]
}

"""
Category entries describe classes for Scale entries with type Nominal or Ordinal.
These are linked to Scale entries.
"""
type Category implements OntologyEntryInterface & RelatedToTerms {
    id: Int!
    name: String!

    description: String
    abbreviation: String
    synonyms: [String]
    authors: [Int]
    references: [Int]

    parents: [Category]
    children: [Category]

    terms: [Term]

    scales: [Scale]
}

"""
Observation method entries describe the way a value is determined.
These are linked to Variable.
Observation method entries require an ObservationMethodType.
Examples: "Distance measurement with calibrated reference", "Short-read sequencing", "Rain Gauge".
"""
type ObservationMethod implements OntologyEntryInterface & RelatedToTerms {
    id: Int!
    name: String!

    description: String
    abbreviation: String
    synonyms: [String]
    authors: [Int]
    references: [Int]

    parents: [ObservationMethod]
    children: [ObservationMethod]

    terms: [Term]

    observationType: ObservationMethodType!
    variables: [Variable]
}

"""
Variable entries link a Trait, ObservationMethod and Scale
to form a single reference term for a Dataset (see Datasets).
Examples:
"Tree height" where:
    Trait = "Height",
    Method = "Distance measurement with calibrated reference",
    Scale = "Centimeters".
"Normalised Expression" where:
    Trait = "Gene expression",
    Method = "Short read sequencing",
    Scale = "Counts per million"
"""
type Variable implements OntologyEntryInterface & RelatedToTerms {
    id: Int!
    name: String!

    description: String
    abbreviation: String
    synonyms: [String]
    authors: [Int]
    references: [Int]

    parents: [Variable]
    children: [Variable]

    terms: [Term]

    trait: Trait!
    observationMethod: ObservationMethod!
    scale: Scale!
}

"""
Control method entries describe the way a value is maintained for an experiment.
These are linked to Factor.
Examples: "Fluorescent Lighting", "Fertilizer application", "Germplasm selection"
"""
type ControlMethod implements OntologyEntryInterface & RelatedToTerms {
    id: Int!
    name: String!

    description: String
    abbreviation: String
    synonyms: [String]
    authors: [Int]
    references: [Int]

    parents: [ControlMethod]
    children: [ControlMethod]

    terms: [Term]

    controlType: ControlMethodType!
    factors: [Factor]
}

"""
Factor entries link a Condition, ControlMethod and Scale
to form a single entry for a Dataset (see Datasets).
Examples:
"Controlled lighting" where:
    Condition = "Light level", ControlMethod = "Fluorescent lighting", Scale = "Micro Einsteins"
OR
"Controlled water availability" where:
    Condition = "Water availability", ControlMethod = "Controlled water application", Scale = "L/m2/day"
OR
"Grafted Material" where:
    Condition = "Genetic material", ControlMethod = "Controlled Grafting", Scale = "Plant Genetic Material"
"""
type Factor implements OntologyEntryInterface & RelatedToTerms {
    id: Int!
    name: String!

    description: String
    abbreviation: String
    synonyms: [String]
    authors: [Int]
    references: [Int]

    parents: [Factor]
    children: [Factor]

    terms: [Term]

    condition: Condition!
    controlMethod: ControlMethod!
    scale: Scale!
}

"""
Event entries link multiple Variables and Factors
Examples:
"Harvest" where "harvest method" may be a factor and "yield" may be a variable.
"""
type Event implements OntologyEntryInterface & RelatedToTerms {
    id: Int!
    name: String!

    description: String
    abbreviation: String
    synonyms: [String]
    authors: [Int]
    references: [Int]

    parents: [Event]
    children: [Event]

    terms: [Term]

    variables: [Variable]
    factors: [Factor]
}

"""
Germplasm method entries describe maintenance or sourcing of germplasm.
These are linked to GermplasmEntry (see Germplasms).
Examples: "Controlled cross", "Mutagenesis", "Ecological survey"
"""
type GermplasmMethod implements OntologyEntryInterface & RelatedToTerms {
    id: Int!
    name: String!

    description: String
    abbreviation: String
    synonyms: [String]
    authors: [Int]
    references: [Int]

    parents: [GermplasmMethod]
    children: [GermplasmMethod]

    terms: [Term]
}

"""
LocationType entries describe types of locations.
These are linked to Location (see Regions).
Examples: "Country", "State", "Field"
"""
type LocationType implements OntologyEntryInterface & RelatedToTerms {
    id: Int!
    name: String!

    description: String
    abbreviation: String
    synonyms: [String]
    authors: [Int]
    references: [Int]

    parents: [LocationType]
    children: [LocationType]

    terms: [Term]
}

"""
LayoutType entries describe types of arrangements.
These are linked to Layout (see Arrangements).
Examples: "Grid", "Rows"
"""
type LayoutType implements OntologyEntryInterface & RelatedToTerms {
    id: Int!
    name: String!

    description: String
    abbreviation: String
    synonyms: [String]
    authors: [Int]
    references: [Int]

    parents: [LayoutType]
    children: [LayoutType]

    terms: [Term]

    axes: [String]
}

"""
Design entries describe statistical designs for a study.
These are linked to Study (see Programs).
Examples: "Split-plot", "Randomized block"
"""
type Design implements OntologyEntryInterface & RelatedToTerms {
    id: Int!
    name: String!

    description: String
    abbreviation: String
    synonyms: [String]
    authors: [Int]
    references: [Int]

    parents: [Design]
    children: [Design]

    terms: [Term]
}

"""
Role entries describe roles for people.
These are linked to Person (see People).
Examples: "Post-doctoral researcher", "Principal Investigator"
"""
type Role implements OntologyEntryInterface & RelatedToTerms {
    id: Int!
    name: String!

    description: String
    abbreviation: String
    synonyms: [String]
    authors: [Int]
    references: [Int]

    parents: [Role]
    children: [Role]

    terms: [Term]
}

"""
Title entries describe titles for people.
These are linked to Person (see People).
Examples: "Professor", "Doctor"
"""
type Title implements OntologyEntryInterface & RelatedToTerms {
    id: Int!
    name: String!

    description: String
    abbreviation: String
    synonyms: [String]
    authors: [Int]
    references: [Int]

    parents: [Title]
    children: [Title]

    terms: [Term]
}

union OntologyEntryUnion = Term | Subject | Trait | Condition | Scale | Category | ObservationMethod | Variable | ControlMethod | Factor | Event | GermplasmMethod | LocationType | LayoutType | Design | Role | Title

type OntologyRelationship {
    id: Int!
    source_id: Int!
    target_id: Int!
    label: OntologyRelationshipLabel!
}